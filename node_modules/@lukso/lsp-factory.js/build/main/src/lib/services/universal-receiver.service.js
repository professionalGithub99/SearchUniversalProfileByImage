"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.deployUniversalReceiverDelegateStore = exports.universalReceiverDelegateDeploymentWithBaseContractAddress$ = exports.universalReceiverDelegateDeployment$ = void 0;
const rxjs_1 = require("rxjs");
const operators_1 = require("rxjs/operators");
const __1 = require("../..");
const deployment_helper_1 = require("../helpers/deployment.helper");
const interfaces_1 = require("../interfaces");
function universalReceiverDelegateDeployment$(signer, accountDeployment$, baseContractDeployment$) {
    return baseContractDeployment$.pipe((0, operators_1.switchMap)((baseContractAddresses) => {
        return universalReceiverDelegateDeploymentWithBaseContractAddress$(signer, accountDeployment$, baseContractAddresses.UniversalReceiverDelegate);
    }), (0, operators_1.shareReplay)());
}
exports.universalReceiverDelegateDeployment$ = universalReceiverDelegateDeployment$;
function universalReceiverDelegateDeploymentWithBaseContractAddress$(signer, accountDeployment$, baseContractAddress) {
    const universalReceiverDelegateDeployment$ = accountDeployment$.pipe((0, operators_1.takeLast)(1), (0, operators_1.switchMap)((result) => {
        return deployUniversalReceiverDelegateStore(signer, result.receipt.contractAddress, baseContractAddress);
    }), (0, operators_1.shareReplay)());
    const universalReceiverDelegateStoreReceipt$ = (0, deployment_helper_1.waitForReceipt)(universalReceiverDelegateDeployment$);
    const universalReceiverDelegateInitialize$ = baseContractAddress
        ? initializeProxy(signer, universalReceiverDelegateStoreReceipt$)
        : rxjs_1.EMPTY;
    const universalReceiverDelegateInitializeReceipt$ = (0, deployment_helper_1.waitForReceipt)(universalReceiverDelegateInitialize$);
    return (0, rxjs_1.concat)(universalReceiverDelegateDeployment$, universalReceiverDelegateStoreReceipt$, universalReceiverDelegateInitialize$, universalReceiverDelegateInitializeReceipt$);
}
exports.universalReceiverDelegateDeploymentWithBaseContractAddress$ = universalReceiverDelegateDeploymentWithBaseContractAddress$;
/**
 * TODO: docs
 */
async function deployUniversalReceiverDelegateStore(signer, lsp3AccountAddress, baseContractAddress) {
    lsp3AccountAddress;
    const deploymentFunction = async () => {
        return baseContractAddress
            ? new __1.LSP1UniversalReceiverDelegateInit__factory(signer).attach(baseContractAddress)
            : await new __1.LSP1UniversalReceiverDelegate__factory(signer).deploy({
                gasLimit: 3000000,
            });
    };
    return baseContractAddress
        ? (0, deployment_helper_1.deployProxyContract)(__1.LSP1UniversalReceiverDelegateInit__factory.abi, deploymentFunction, interfaces_1.ContractNames.UNIVERSAL_RECEIVER, signer)
        : (0, deployment_helper_1.deployContract)(deploymentFunction, interfaces_1.ContractNames.UNIVERSAL_RECEIVER);
}
exports.deployUniversalReceiverDelegateStore = deployUniversalReceiverDelegateStore;
function initializeProxy(signer, universalReceiverDelegateReceipt$) {
    return (0, deployment_helper_1.initialize)(universalReceiverDelegateReceipt$, new __1.LSP1UniversalReceiverDelegateInit__factory(signer), async () => {
        return [];
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidW5pdmVyc2FsLXJlY2VpdmVyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvbGliL3NlcnZpY2VzL3VuaXZlcnNhbC1yZWNlaXZlci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUNBLCtCQUFpRDtBQUNqRCw4Q0FBa0U7QUFFbEUsNkJBS2U7QUFDZixvRUFLc0M7QUFDdEMsOENBQThDO0FBUTlDLFNBQWdCLG9DQUFvQyxDQUNsRCxNQUFjLEVBQ2Qsa0JBQTBELEVBQzFELHVCQUdFO0lBRUYsT0FBTyx1QkFBdUIsQ0FBQyxJQUFJLENBQ2pDLElBQUEscUJBQVMsRUFBQyxDQUFDLHFCQUFxQixFQUFFLEVBQUU7UUFDbEMsT0FBTywyREFBMkQsQ0FDaEUsTUFBTSxFQUNOLGtCQUFrQixFQUNsQixxQkFBcUIsQ0FBQyx5QkFBeUIsQ0FDaEQsQ0FBQztJQUNKLENBQUMsQ0FBQyxFQUNGLElBQUEsdUJBQVcsR0FBRSxDQUNkLENBQUM7QUFDSixDQUFDO0FBbEJELG9GQWtCQztBQUVELFNBQWdCLDJEQUEyRCxDQUN6RSxNQUFjLEVBQ2Qsa0JBQTBELEVBQzFELG1CQUEyQjtJQUUzQixNQUFNLG9DQUFvQyxHQUFHLGtCQUFrQixDQUFDLElBQUksQ0FDbEUsSUFBQSxvQkFBUSxFQUFDLENBQUMsQ0FBQyxFQUNYLElBQUEscUJBQVMsRUFBQyxDQUFDLE1BQU0sRUFBRSxFQUFFO1FBQ25CLE9BQU8sb0NBQW9DLENBQ3pDLE1BQU0sRUFDTixNQUFNLENBQUMsT0FBTyxDQUFDLGVBQWUsRUFDOUIsbUJBQW1CLENBQ3BCLENBQUM7SUFDSixDQUFDLENBQUMsRUFDRixJQUFBLHVCQUFXLEdBQUUsQ0FDZCxDQUFDO0lBRUYsTUFBTSxzQ0FBc0MsR0FBRyxJQUFBLGtDQUFjLEVBQzNELG9DQUFvQyxDQUNyQyxDQUFDO0lBRUYsTUFBTSxvQ0FBb0MsR0FBRyxtQkFBbUI7UUFDOUQsQ0FBQyxDQUFDLGVBQWUsQ0FDYixNQUFNLEVBQ04sc0NBQWtGLENBQ25GO1FBQ0gsQ0FBQyxDQUFDLFlBQUssQ0FBQztJQUVWLE1BQU0sMkNBQTJDLEdBQy9DLElBQUEsa0NBQWMsRUFBbUMsb0NBQW9DLENBQUMsQ0FBQztJQUV6RixPQUFPLElBQUEsYUFBTSxFQUNYLG9DQUFvQyxFQUNwQyxzQ0FBc0MsRUFDdEMsb0NBQW9DLEVBQ3BDLDJDQUEyQyxDQUM1QyxDQUFDO0FBQ0osQ0FBQztBQXJDRCxrSUFxQ0M7QUFFRDs7R0FFRztBQUNJLEtBQUssVUFBVSxvQ0FBb0MsQ0FDeEQsTUFBYyxFQUNkLGtCQUEwQixFQUMxQixtQkFBMkI7SUFFM0Isa0JBQWtCLENBQUM7SUFDbkIsTUFBTSxrQkFBa0IsR0FBRyxLQUFLLElBQUksRUFBRTtRQUNwQyxPQUFPLG1CQUFtQjtZQUN4QixDQUFDLENBQUMsSUFBSSw4Q0FBMEMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxNQUFNLENBQUMsbUJBQW1CLENBQUM7WUFDcEYsQ0FBQyxDQUFDLE1BQU0sSUFBSSwwQ0FBc0MsQ0FBQyxNQUFNLENBQUMsQ0FBQyxNQUFNLENBQUM7Z0JBQzlELFFBQVEsRUFBRSxPQUFTO2FBQ3BCLENBQUMsQ0FBQztJQUNULENBQUMsQ0FBQztJQUVGLE9BQU8sbUJBQW1CO1FBQ3hCLENBQUMsQ0FBQyxJQUFBLHVDQUFtQixFQUNqQiw4Q0FBMEMsQ0FBQyxHQUFHLEVBQzlDLGtCQUFrQixFQUNsQiwwQkFBYSxDQUFDLGtCQUFrQixFQUNoQyxNQUFNLENBQ1A7UUFDSCxDQUFDLENBQUMsSUFBQSxrQ0FBYyxFQUFDLGtCQUFrQixFQUFFLDBCQUFhLENBQUMsa0JBQWtCLENBQUMsQ0FBQztBQUMzRSxDQUFDO0FBdEJELG9GQXNCQztBQUVELFNBQVMsZUFBZSxDQUN0QixNQUFjLEVBQ2QsaUNBQTJFO0lBRTNFLE9BQU8sSUFBQSw4QkFBVSxFQUNmLGlDQUFpQyxFQUNqQyxJQUFJLDhDQUEwQyxDQUFDLE1BQU0sQ0FBQyxFQUN0RCxLQUFLLElBQUksRUFBRTtRQUNULE9BQU8sRUFBRSxDQUFDO0lBQ1osQ0FBQyxDQUNGLENBQUM7QUFDSixDQUFDIn0=