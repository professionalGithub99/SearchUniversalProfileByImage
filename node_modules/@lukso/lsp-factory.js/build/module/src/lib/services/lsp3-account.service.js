var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
import axios from 'axios';
import { ContractFactory } from 'ethers';
import { concat, defer, EMPTY, forkJoin, from, of } from 'rxjs';
import { shareReplay, switchMap } from 'rxjs/operators';
import { LSP3UniversalProfile, UniversalProfile__factory, UniversalProfileInit__factory, } from '../..';
import { ADDRESS_PERMISSIONS_ARRAY_KEY, ALL_PERMISSIONS, LSP3_UP_KEYS, PREFIX_PERMISSIONS, SET_DATA_PERMISSION, } from '../helpers/config.helper';
import { deployContract, getProxyByteCode, initialize, waitForReceipt, } from '../helpers/deployment.helper';
import { encodeLSP3Profile } from '../helpers/erc725.helper';
import { ContractNames, DeploymentStatus, DeploymentType, } from '../interfaces';
export function accountDeployment$(signer, controllerAddresses, baseContractAddresses$) {
    return baseContractAddresses$.pipe(switchMap((baseContractAddresses) => {
        return accountDeploymentWithBaseContractAddress$(signer, controllerAddresses, baseContractAddresses.ERC725Account);
    }), shareReplay());
}
export function accountDeploymentWithBaseContractAddress$(signer, controllerAddresses, baseContractAddress) {
    const accountDeployment$ = defer(() => deployLSP3Account(signer, controllerAddresses, baseContractAddress)).pipe(shareReplay());
    const accountDeploymentReceipt$ = waitForReceipt(accountDeployment$).pipe(shareReplay());
    const accountDeploymentInitialize$ = baseContractAddress
        ? initializeProxy(signer, accountDeploymentReceipt$)
        : EMPTY;
    const accountDeploymentInitializeReceipt$ = waitForReceipt(accountDeploymentInitialize$).pipe(shareReplay());
    return concat(accountDeployment$, accountDeploymentReceipt$, accountDeploymentInitialize$, accountDeploymentInitializeReceipt$);
}
function deployLSP3Account(signer, ownerAddresses, baseContractAddress) {
    return __awaiter(this, void 0, void 0, function* () {
        const deploymentFunction = () => __awaiter(this, void 0, void 0, function* () {
            return baseContractAddress
                ? new UniversalProfileInit__factory(signer).attach(baseContractAddress)
                : yield new UniversalProfile__factory(signer).deploy(ownerAddresses[0]);
        });
        return baseContractAddress
            ? deployProxyContract(deploymentFunction, signer)
            : deployContract(deploymentFunction, ContractNames.ERC725_Account);
    });
}
export function deployProxyContract(deployContractFunction, signer) {
    return __awaiter(this, void 0, void 0, function* () {
        try {
            const contract = yield deployContractFunction();
            const factory = new ContractFactory(UniversalProfile__factory.abi, getProxyByteCode(contract.address), signer);
            const deployedProxy = yield factory.deploy(signer.getAddress());
            const transaction = deployedProxy.deployTransaction;
            return {
                type: DeploymentType.PROXY,
                contractName: ContractNames.ERC725_Account,
                status: DeploymentStatus.PENDING,
                transaction,
            };
        }
        catch (error) {
            console.error(`Error when deploying ${ContractNames.ERC725_Account}`, error);
            throw error;
        }
    });
}
function initializeProxy(signer, accountDeploymentReceipt$) {
    return initialize(accountDeploymentReceipt$, new UniversalProfileInit__factory(signer), () => __awaiter(this, void 0, void 0, function* () {
        const signerAddress = yield signer.getAddress();
        return [signerAddress];
    })).pipe(shareReplay());
}
export function setDataTransaction$(signer, account$, universalReceiver$, controllerAddresses, lsp3ProfileData$) {
    const setDataTransaction$ = forkJoin([account$, universalReceiver$, lsp3ProfileData$]).pipe(switchMap(([{ receipt: lsp3AccountReceipt }, { receipt: universalReceiverDelegateReceipt }, lsp3ProfileData,]) => {
        return setData(signer, lsp3AccountReceipt.contractAddress || lsp3AccountReceipt.to, universalReceiverDelegateReceipt.contractAddress || universalReceiverDelegateReceipt.to, controllerAddresses, lsp3ProfileData);
    }), shareReplay());
    const setDataReceipt$ = waitForReceipt(setDataTransaction$);
    return concat(setDataTransaction$, setDataReceipt$);
}
export function getLsp3ProfileDataUrl(lsp3Profile) {
    return __awaiter(this, void 0, void 0, function* () {
        let lsp3ProfileData;
        if (typeof lsp3Profile === 'string') {
            let lsp3JsonUrl = lsp3Profile;
            const isIPFSUrl = lsp3Profile.startsWith('ipfs://');
            if (isIPFSUrl) {
                lsp3JsonUrl = 'https://ipfs.lukso.network/ipfs/' + lsp3Profile.split('/').at(-1); // TODO: Allow custom IPFS upload location
            }
            const ipfsResponse = yield axios.get(lsp3JsonUrl);
            const lsp3ProfileJson = ipfsResponse.data;
            lsp3ProfileData = {
                url: lsp3Profile,
                profile: lsp3ProfileJson,
            };
        }
        else {
            lsp3ProfileData = yield LSP3UniversalProfile.uploadProfileData(lsp3Profile);
        }
        return lsp3ProfileData;
    });
}
export function isLSP3ProfileDataEncoded(lsp3Profile) {
    if (!lsp3Profile.startsWith('ipfs://') && !lsp3Profile.startsWith('https://')) {
        return true;
    }
    return false;
}
export function lsp3ProfileUpload$(lsp3Profile) {
    let lsp3Profile$;
    if (typeof lsp3Profile !== 'string' || !isLSP3ProfileDataEncoded(lsp3Profile)) {
        lsp3Profile$ = lsp3Profile ? from(getLsp3ProfileDataUrl(lsp3Profile)) : of(null);
    }
    else {
        lsp3Profile$ = of(lsp3Profile);
    }
    return lsp3Profile$;
}
/**
 * TODO: docs
 */
export function setData(signer, erc725AccountAddress, universalReceiverDelegateAddress, controllerAddresses, lsp3Profile) {
    return __awaiter(this, void 0, void 0, function* () {
        let encodedLSP3Profile;
        if (lsp3Profile && typeof lsp3Profile !== 'string') {
            const encodedDataResult = lsp3Profile
                ? encodeLSP3Profile(lsp3Profile.profile, lsp3Profile.url)
                : null;
            encodedLSP3Profile = encodedDataResult.LSP3Profile.value;
        }
        else {
            encodedLSP3Profile = lsp3Profile;
        }
        const erc725Account = new UniversalProfile__factory(signer).attach(erc725AccountAddress);
        let controllerAddress;
        let signerPermissions;
        if (typeof controllerAddresses[0] === 'string') {
            controllerAddress = controllerAddresses[0];
        }
        else {
            controllerAddress = controllerAddresses[0].address;
            signerPermissions = controllerAddresses[0].permissions;
        }
        const keysToSet = [
            LSP3_UP_KEYS.UNIVERSAL_RECEIVER_DELEGATE_KEY,
            PREFIX_PERMISSIONS + controllerAddress.substr(2),
            PREFIX_PERMISSIONS + universalReceiverDelegateAddress.substr(2),
            ADDRESS_PERMISSIONS_ARRAY_KEY,
            ADDRESS_PERMISSIONS_ARRAY_KEY.slice(0, 34) + '00000000000000000000000000000000',
            ADDRESS_PERMISSIONS_ARRAY_KEY.slice(0, 34) + '00000000000000000000000000000001',
        ];
        const valuesToSet = [
            universalReceiverDelegateAddress,
            signerPermissions !== null && signerPermissions !== void 0 ? signerPermissions : ALL_PERMISSIONS,
            SET_DATA_PERMISSION,
            2,
            controllerAddress,
            universalReceiverDelegateAddress,
        ];
        if (encodedLSP3Profile) {
            keysToSet.push(LSP3_UP_KEYS.LSP3_PROFILE);
            valuesToSet.push(encodedLSP3Profile);
        }
        const transaction = yield erc725Account.setData(keysToSet, valuesToSet, {
            gasLimit: 1000000,
        });
        return {
            type: DeploymentType.TRANSACTION,
            contractName: ContractNames.ERC725_Account,
            functionName: 'setData',
            status: DeploymentStatus.PENDING,
            transaction,
        };
    });
}
export function getTransferOwnershipTransaction$(signer, accountDeployment$, keyManagerDeployment$) {
    const transferOwnershipTransaction$ = forkJoin([accountDeployment$, keyManagerDeployment$]).pipe(switchMap(([{ receipt: lsp3AccountReceipt }, { receipt: keyManagerContract }]) => {
        return transferOwnership(signer, lsp3AccountReceipt, keyManagerContract);
    }), shareReplay());
    const transferOwnershipReceipt$ = waitForReceipt(transferOwnershipTransaction$);
    return concat(transferOwnershipTransaction$, transferOwnershipReceipt$);
}
/**
 * TODO: docs
 */
export function transferOwnership(signer, lsp3AccountReceipt, keyManagerReceipt) {
    return __awaiter(this, void 0, void 0, function* () {
        try {
            const signerAddress = yield signer.getAddress();
            const contract = new UniversalProfile__factory(signer).attach(lsp3AccountReceipt.contractAddress || lsp3AccountReceipt.to);
            const transaction = yield contract.transferOwnership(keyManagerReceipt.contractAddress || keyManagerReceipt.to, {
                from: signerAddress,
                gasLimit: 500000,
            });
            return {
                type: DeploymentType.TRANSACTION,
                status: DeploymentStatus.PENDING,
                contractName: ContractNames.ERC725_Account,
                functionName: 'transferOwnership',
                transaction,
            };
        }
        catch (error) {
            console.error('Error when transferring Ownership', error);
            throw error;
        }
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibHNwMy1hY2NvdW50LnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvbGliL3NlcnZpY2VzL2xzcDMtYWNjb3VudC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUNBLE9BQU8sS0FBSyxNQUFNLE9BQU8sQ0FBQztBQUMxQixPQUFPLEVBQXVCLGVBQWUsRUFBVSxNQUFNLFFBQVEsQ0FBQztBQUN0RSxPQUFPLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBYyxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDNUUsT0FBTyxFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUV4RCxPQUFPLEVBQ0wsb0JBQW9CLEVBQ3BCLHlCQUF5QixFQUN6Qiw2QkFBNkIsR0FDOUIsTUFBTSxPQUFPLENBQUM7QUFDZixPQUFPLEVBQ0wsNkJBQTZCLEVBQzdCLGVBQWUsRUFDZixZQUFZLEVBQ1osa0JBQWtCLEVBQ2xCLG1CQUFtQixHQUNwQixNQUFNLDBCQUEwQixDQUFDO0FBQ2xDLE9BQU8sRUFDTCxjQUFjLEVBQ2QsZ0JBQWdCLEVBQ2hCLFVBQVUsRUFDVixjQUFjLEdBQ2YsTUFBTSw4QkFBOEIsQ0FBQztBQUN0QyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUM3RCxPQUFPLEVBQ0wsYUFBYSxFQU1iLGdCQUFnQixFQUNoQixjQUFjLEdBR2YsTUFBTSxlQUFlLENBQUM7QUFPdkIsTUFBTSxVQUFVLGtCQUFrQixDQUNoQyxNQUFjLEVBQ2QsbUJBQTZCLEVBQzdCLHNCQUdFO0lBRUYsT0FBTyxzQkFBc0IsQ0FBQyxJQUFJLENBQ2hDLFNBQVMsQ0FBQyxDQUFDLHFCQUFxQixFQUFFLEVBQUU7UUFDbEMsT0FBTyx5Q0FBeUMsQ0FDOUMsTUFBTSxFQUNOLG1CQUFtQixFQUNuQixxQkFB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